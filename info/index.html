<!DOCTYPE html>
<html lang="hy">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="icon" type="image/jpg" href="https://pha.am/rounded_favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="stylesheet" href="/thestyle.css">
    <link rel="manifest" href="/manifest.json">

    <!-- Authentication -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAbnPpcIt88B0jIAoLUdC71zmQDvR_fdu8",
            authDomain: "physmathacademy-722b3.firebaseapp.com",
            projectId: "physmathacademy-722b3",
            storageBucket: "physmathacademy-722b3.appspot.com",
            messagingSenderId: "1093649922622",
            appId: "1:1093649922622:web:35b1bf4d2364bcf745f587",
            measurementId: "G-CGVKXTXJLB"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        onAuthStateChanged(auth, (user) => {
            if (!user) {
                window.location.href = "/login/"; // Redirect if not logged in
                return;
            }

            const userEmail = user.email.toLowerCase();
            const userName = userEmail.split("@")[0]; // Extracts username from 'username@pha.am'

            // Get the current page path (e.g., '/info/' or '/aramasatryan290/')
            const currentPath = window.location.pathname.replace(/\//g, "").toLowerCase();

            if (userName !== currentPath) {
                // If logged-in user tries to access another user's page, redirect
                window.location.href = "/login/";
            }
        });

        window.logout = async () => {
            try {
                await signOut(auth);
                window.location.href = "/login/";
            } catch (error) {
                console.error("Logout error:", error);
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <img src="https://yt3.ggpht.com/_E7rfQLqO3yvWXrLXnS-3rN_BScG9RiZJQuv2rON7vPDZTKkuxkCQ_oa0Kv8R2D2SzSMTmr7mA=s176-c-k-c0x00ffffff-no-rj-mo" alt="PhA Logo" class="profile-image">
        
        <div class="id-container">
            <h2>511639</h2>
            <img src="https://pha.am/cloud.png" alt="Install App" class="install-icon" id="installIcon">
        </div>

        <p class="description">Բարի գալուստ, սա Ձեր անհատականացված PhA վահանակն է info</p>
        
        <a class="buttonO" href="https://pha.am/homework/">Թեստային աշխատանք</a>
        <a class="button" href="https://meet.google.com/uko-nxgb-nuf">Միանալ դասին</a>
        <a class="button" href="https://calendar.google.com/calendar/embed?src=441cbb27cfab02a3190e10174dcfeab17f03d8a67da61df498b57918a56f0270%40group.calendar.google.com&ctz=Asia%2FYerevan">Հաճախություն</a>
        <a class="button" href="#" onclick="checkSubscription()">Բաժանորդագրություն</a>
        <a class="button" href="https://invite.viber.com/?g2=AQAYUchWgqzljlQ7yDrGFe13X2ZDWJdjYJJtUvzMw9UWb08m7dWDP2P%2BFcabN3fX">Համայնք</a>
        <button class="button" onclick="logout()" style="background: #dc3545;">Դուրս գալ</button>
    </div>

    <script>
        // Installation prompt script
        let deferredPrompt;

        window.addEventListener("beforeinstallprompt", (event) => {
            event.preventDefault();
            deferredPrompt = event;
            document.getElementById("installIcon").style.display = "inline";
        });

        document.getElementById("installIcon").addEventListener("click", () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === "accepted") {
                        console.log("User installed the app");
                    }
                    deferredPrompt = null;
                });
            } else if (isIos() && !isInStandaloneMode()) {
                alert("To install, tap the Share button and then 'Add to Home Screen'.");
            }
        });

        function isIos() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        }

        function isInStandaloneMode() {
            return window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone;
        }

        if (isIos() && !isInStandaloneMode()) {
            document.getElementById("installIcon").style.display = "inline";
        }

        function checkSubscription() {
            alert('Ձեր բաժանորդագրությունը ԱԿՏԻՎ է մինչև 01.03.2025');
        }
    </script>
</body>
</html>
