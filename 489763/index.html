<!DOCTYPE html>
<html lang="hy">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="icon" type="image/jpg" href="/rounded_favicon.png">
    <link rel="stylesheet" href="styles.css">
    <script>
        async function fetchNotification() {
            const userId = "489763"; // Replace dynamically with the logged-in user ID
            const sheetUrl = "https://docs.google.com/spreadsheets/d/1jBXmjxpWvOfNwOF3bjtYOmtdsv1-iWEiUkdopl9t2uo/gviz/tq?tqx=out:json";

            try {
                const response = await fetch(sheetUrl);
                if (!response.ok) throw new Error("Failed to fetch sheet data");

                const text = await response.text();
                const json = JSON.parse(text.substring(47, text.length - 2));

                console.log("Fetched JSON:", json); // Debugging log

                const rows = json.table.rows; // Get rows

                let notification = "";
                let userColumnIndex = -1;

                // ✅ Step 1: Find the correct column for the user ID
                if (rows.length > 0) {
                    const userRow = rows[0].c; // Get first row (User IDs)
                    for (let i = 0; i < userRow.length; i++) {
                        if (userRow[i]?.v == userId) {
                            userColumnIndex = i; // Found the correct column
                            break;
                        }
                    }
                }

                // ✅ Step 2: Get the notification from the second row
                if (userColumnIndex !== -1 && rows.length > 1) {
                    notification = rows[1].c[userColumnIndex]?.v || ""; // Fetch notification message
                }

                console.log("Notification for User:", notification); // Debugging log

                if (notification) {
                    document.getElementById("notification").innerText = notification;
                } else {
                    document.getElementById("notification").style.display = "none"; // Hide if no message
                }
            } catch (error) {
                console.error("Error fetching notification:", error);
                document.getElementById("notification").style.display = "none"; // Hide if fetch fails
            }
        }
        window.onload = fetchNotification;
    </script>
</head>
<body>
    <div class="container">
        <img src="https://yt3.ggpht.com/_E7rfQLqO3yvWXrLXnS-3rN_BScG9RiZJQuv2rON7vPDZTKkuxkCQ_oa0Kv8R2D2SzSMTmr7mA=s176-c-k-c0x00ffffff-no-rj-mo" alt="PhA Logo" class="profile-image">
        <h2>489763</h2>
        <p class="description">Բարի գալուստ։ Սա Ձեր անհատականացված PhA վահանակն է</p>

        <!-- ✅ Notification Section (Hidden if empty) -->
        <p id="notification" style="color: red; font-weight: bold;"></p>

        <a class="button" href="https://meet.google.com/nhv-gmwm-ied">Միանալ դասին</a>
        <a class="button" href="https://calendar.google.com/calendar/embed?src=e923ac60833ec46da83148460e293f0ae015a88f1faacdba726482a511d3a26d%40group.calendar.google.com&ctz=Asia%2FYerevan">Հաճախություն</a>
        <a class="button" href="https://docs.google.com/presentation/d/1d1pa6v3M4mTs3hp-_D0mA25wv0ziufQKlpQInutezqw/edit?usp=sharing">Բաժանորդագրություն</a>
        <a class="button" href="https://invite.viber.com/?g2=AQAYUchWgqzljlQ7yDrGFe13X2ZDWJdjYJJtUvzMw9UWb08m7dWDP2P%2BFcabN3fX">Համայնք</a>
        <a id="quiz-button" class="button" href="#">Թեստ</a>
    </div>
</body>
</html>

